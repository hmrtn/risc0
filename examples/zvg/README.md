# Onchain SVG Generation With Bonsai

## Getting Started

This project leverages the capabilities of RISC Zero's Bonsai network and zkVM
to generate SVG (Scalable Vector Graphics) images and store them directly on a
blockchain. The Bonsai network's ability to perform off-chain computations is a
key component in the generation of these images. Users interact with this system
through a minting process, which results in the creation of a unique SVG string
that is stored in an ERC-721 contract, a standard for non-fungible tokens on the
Ethereum blockchain.

### Methods

The main functionality of the code is encapsulated in two structures:
`ColorGenerator` and `SvgGenerator`.

- `ColorGenerator` is responsible for generating random colors. It uses a pseudo-
random number generator (`SmallRng`) seeded with a provided value to generate
random colors in the form of hexadecimal color codes.
- `SvgGenerator` uses `ColorGenerator` to generate SVG images. The SVG images are
composed of a random colors and text with colors determined by the `ColorGenerator`.
The number of colors, the seed for the color generator, and an ID for the SVG
image are provided upon the creation of an `SvgGenerator` instance of the user.
The main function is the entry point of the program. It reads input from the
environment, decodes it into a 256-bit unsigned integer (`U256`), and uses this
value as the ID and seed for the `SvgGenerator`. The `SvgGenerator` then generates
an SVG image, which is encoded along with the ID and committed back to the
environment, and made available on the smart contract.

### Contracts

The contract `ZVG` is an ERC-721 contract that stores the SVG images generated by
the `SvgGenerator`. It maps each token ID to its corresponding SVG string. The
contract provides a mint function that allows users to create a new token with
a unique ID, and a burn function that allows users to destroy a token they own.
When a new token is minted, a request is submitted to the Bonsai network to
generate a new SVG image. The resulting SVG string is stored in the contract
and can be accessed via the `tokenURI` method.

### Build

Running the following will build the project, including Ethereum contracts and
RISC Zero guest program.

```bash
cargo build
```

### Test

Running the following will run all tests, including Ethereum contracts and RISC Zero guest program.

```bash
cargo test
```

#### Deploy

The `deploy` command shows how to deploy your application to Bonsai and to an Ethereum chain.

```text
cargo --bin deploy -- --help
Usage: deploy --ethereum-node-url <ETHEREUM_NODE_URL> --bonsai-url <BONSAI_URL> --bonsai-proxy-contract-address <BONSAI_PROXY_CONTRACT_ADDRESS> --bonsai-api-key <BONSAI_API_KEY> --ethereum-private-key <ETHEREUM_PRIVATE_KEY>

Options:
  -e, --ethereum-node-url <ETHEREUM_NODE_URL>
          JSON RPC URL for an Ethereum node that will serve call and transaction requests. Currently only HTTP(S) URLs are supported.
  -b, --bonsai-url <BONSAI_URL>
          URL for the Bonsai service for to upload the ELF binary
  -p, --bonsai-proxy-contract-address <BONSAI_PROXY_CONTRACT_ADDRESS>
          Ethereum contract address for the Bonsai proxy
      --bonsai-api-key <BONSAI_API_KEY>
          API Key for Bonsai to authorize requests
      --ethereum-private-key <ETHEREUM_PRIVATE_KEY>
          Ethereum private key to use for sending transactions
```

#### Poke

The `poke` command shows a basic interaction with the application contract.
Making a request an waiting for a callback from Bonsai.

```text
cargo --bin poke -- --help
Usage: poke --ethereum-node-url <ETHEREUM_NODE_URL> --hello-bonsai-contract-address <HELLO_BONSAI_CONTRACT_ADDRESS> --ethereum-private-key <ETHEREUM_PRIVATE_KEY> <N>

Arguments:
  <N>  Value of n to use as the input to the Fibonacci calculation

Options:
  -e, --ethereum-node-url <ETHEREUM_NODE_URL>
          JSON RPC URL for an Ethereum node that will serve call and transaction requests. Currently only HTTP(S) URLs are supported
  -a, --hello-bonsai-contract-address <HELLO_BONSAI_CONTRACT_ADDRESS>
          HelloBonsai contract address
      --ethereum-private-key <ETHEREUM_PRIVATE_KEY>
          Ethereum private key to use for sending transactions
```

[Bonsai]: https://dev.bonsai.xyz/
[RISC Zero]: https://www.risczero.com/
[ethers]: https://docs.rs/ethers/latest/ethers/
[Cargo]: https://doc.rust-lang.org/cargo/
[RISC Zero examples]: https://github.com/risc0/risc0/tree/main/examples
[RISC-V]: https://www.risczero.com/docs/reference-docs/about-risc-v
[waitlist]: https://fmree464va4.typeform.com/to/t6hZD54Z
